# LensChecks
Репозиторий, где собраны все компоненты модульной проверки анкет.

## Подготовка к использованию
Перед самым первым запуском необходимо:
1. Установить git, если не установлен (https://git-scm.com/install/windows)
2. Склонировать репозиторий LensCheck. Для этого открыть рабочую папку и в ней ПКМ открыть терминал (например PowerShell), далее набрать команду ```git clone https://github.com/Ivsoffy/LensChecks.git```
3. Проверить наличие и версию python командой ```python --version``` (в идеале 3.13.5). Установить requirements.txt, для этого набрать в терминале вашего IDE (например, jupyter): \
```pip install -r requirements.txt```
4. В том же терминале написать ```python -m spacy download ru_core_news_lg```
5. Скачать модели для выставления кодов (https://disk.360.yandex.ru/d/LCNN_Y88KYkxrQ) и поместить их в папку LensChecks\Modules\src\module_2\function_model\final_models

## Инструкция по использованию
Запуск проверки состоит из двух шагов:
- Настройка config.yml
- Запуск start.py

### Config.yml
Здесь можно настроить параметры проверки.\
Общие параметры:
- module: [1,2,3,4] - Выбор модуля для проверки
- input_folder: Директория с проверяемым файлом
- output_folder: Директория, куда будут помещены результаты проверки

Параметры для разных модулей:
#### 1 модуль
- save_db_only_without_errors: [True,False] - True, если нужно сохранить анкету для продолжения проверки, даже если в анкете присутствуют ошибки
#### 2 и 3 модули
- folder_past_year: - Директория с анкетами прошлого года для подтягивания кодов и грейдов
- after_fix: [True,False] - Выставляется True после того, как аналитик проверил коды и грейды, чтобы отобразить проверенные уникальные значения на всю таблицу.
#### 4 модуль
- save_to_parquet: [True,False] - True, если нужно сохранить БД в .parquet

### Запуск start.py
Запуск обязательно производить из директории LensChecks/Modules/ и находясь в том окружении, где устанавливались зависимости из requirements.txt. Запустить код можно в jupyter или через терминал: \
```python start.py```

## Информация по каждому модулю
### Модуль 1
Техническая проверка. В файле исправляются ошибки, данные нормализуются до выпадающих списков, проверяется заполнение обязательных колонок.\
**Input:** Директория с анкетами от клиентов в формате Lens.\
**Output:**
- output_folder/company_name.xlsx - Excel-файлы с исправленными данными для каждой компании.
- input_folder/unprocessed/company_name.xlsx - Анкеты от клиентов в формате Lens с добавлением страницы "Ошибки", на которой перечислены все ошибки. На странице "Данные" все ошибочные строки подсвечены цветом.
### Модуль 2
Проверка и выставление кодов функий. Происходит в 2 этапа. На первом этапе код подтягивает функции с прошлого года и выставляет моделью все, что осталось непроставленным. Аналитик проверяет, вносит правки на листы Prefill и Model. На втором этапе код запускается с параметром ```after_fix: True```, все значения из Prefill и Model подтягиваются в исходную таблицу.

1-й этап:

**Input**: Директория с файлами (output_folder/company_name.xlsx), полученными в предыдущем модуле.\
**Output**: output_folder/company_name.xlsx - Excel-файлы с четырьмя листами:
1. Sheet1 - все данные с подтянутыми кодами с прошлого года.
2. Prefill - уникальные строки, в которых коды уже были предзаполнены
3. Model - уникальные строки, в которых коды проставила модель
4. Информация о файле.

2-й этап:

**Input**: Директория с файлами (output_folder/company_name.xlsx), полученными после первого этапа.\
**Output**: Excel-файлы, в которых исправленные аналитиком значения на листах Prefill, Model перенесены в общую таблицу.
